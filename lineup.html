<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Match Lineup</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#111;
  color:white;
}

header {
  text-align:center;
  padding:15px;
  font-size:22px;
}

.controls {
  padding:15px;
}

select, button {
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:14px;
}

#pitch {
  position:relative;
  width:100%;
  height:70vh;
  background:#1b5e20;
  border:3px solid white;
  overflow:hidden;
}

/* h≈ôi≈°tƒõ ƒç√°ry */
.center-line {
  position:absolute;
  width:100%;
  height:2px;
  background:white;
  top:50%;
}

.center-circle {
  position:absolute;
  width:140px;
  height:140px;
  border:2px solid white;
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

/* hr√°ƒçi */
.player {
  position:absolute;
  width:60px;
  height:60px;
  border-radius:50%;
  background:#00fff7;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  text-align:center;
  cursor:grab;
  z-index:10;
}

.player input {
  width:100%;
  background:transparent;
  border:none;
  text-align:center;
  font-size:10px;
  outline:none;
}
</style>
</head>

<body>

<header>‚öΩ MATCH LINEUP BUILDER</header>

<div class="controls">
  <select id="formationSelect">
    <option value="1-4-4-2">1-4-4-2</option>
    <option value="1-4-2-3-1">1-4-2-3-1</option>
    <option value="1-4-3-3">1-4-3-3</option>
    <option value="1-3-5-2">1-3-5-2</option>
  </select>

  <button id="createBtn">Vytvo≈ôit rozestaven√≠</button>
  <button id="saveBtn">üíæ Ulo≈æit sestavu</button>
  <button id="exportBtn">üì∑ Export obr√°zku</button>
</div>

<div id="pitch">
  <div class="center-line"></div>
  <div class="center-circle"></div>
</div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<script>
const pitch = document.getElementById("pitch");
const createBtn = document.getElementById("createBtn");
const saveBtn = document.getElementById("saveBtn");
const exportBtn = document.getElementById("exportBtn");
const formationSelect = document.getElementById("formationSelect");

let players = [];

/* vytvo≈ôen√≠ rozestaven√≠ */
createBtn.addEventListener("click", () => {

  // sma≈æ star√© hr√°ƒçe
  pitch.querySelectorAll(".player").forEach(p => p.remove());
  players = [];

  const rows = formationSelect.value.split("-").map(Number);

  const h = pitch.clientHeight;
  const w = pitch.clientWidth;

  rows.forEach((count, rowIndex) => {

    for (let i = 0; i < count; i++) {

      const player = document.createElement("div");
      player.className = "player";

      const input = document.createElement("input");

      // üß§ GK ‚Äì prvn√≠ ≈ôada a jeden hr√°ƒç
      if (rowIndex === 0 && count === 1) {
        input.value = "GK";
        player.style.background = "#ffcc00"; // jin√° barva
      } else {
        input.placeholder = "Hr√°ƒç";
      }

      player.appendChild(input);

      // vertik√°ln√≠ rozlo≈æen√≠ (odspodu nahoru)
      const y = h - (rowIndex + 1) * (h / (rows.length + 1));

      // horizont√°ln√≠ rozlo≈æen√≠
      const x = (i + 1) * (w / (count + 1));

      player.style.left = x + "px";
      player.style.top = y + "px";

      makeDraggable(player);

      pitch.appendChild(player);
      players.push(player);
    }
  });

});

/* drag */
function makeDraggable(el) {
  let offsetX, offsetY;

  el.addEventListener("pointerdown", e => {
    offsetX = e.offsetX;
    offsetY = e.offsetY;
    el.setPointerCapture(e.pointerId);
  });

  el.addEventListener("pointermove", e => {
    if (e.buttons !== 1) return;
    el.style.left = (e.pageX - pitch.offsetLeft - offsetX) + "px";
    el.style.top = (e.pageY - pitch.offsetTop - offsetY) + "px";
  });
}

/* ulo≈æit */
saveBtn.addEventListener("click", () => {
  const data = players.map(p => ({
    name: p.querySelector("input").value,
    x: p.style.left,
    y: p.style.top
  }));

  localStorage.setItem("MATCH_LINEUP", JSON.stringify(data));
  alert("Sestava ulo≈æena ‚úî");
});

/* export obr√°zku */
exportBtn.addEventListener("click", () => {
  html2canvas(pitch).then(canvas => {
    const link = document.createElement("a");
    link.download = "sestava.png";
    link.href = canvas.toDataURL();
    link.click();
  });
});
</script>

</body>
</html>
